@model DataAccessLibrary.Model.AppointmentMaster

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Index</h2>
<div id="calendar"></div>

<div id="myModal" class="modal fade" role="dialog">
    <!-- Modal content -->
</div>

<div id="myModalSave" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Save Event</h4>
            </div>
            <div class="modal-body">
                <form class="col-md-12 form-horizontal">
                    <input type="hidden" id="hdEventID" value="" />
                    <div class="form-group">
                        <label asp-for="PId">Patient ID</label>
                        <input type="text" asp-for="PId" id="txtPId" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="DId">Doctor ID</label>
                        <input type="text" asp-for="DId" id="txtDId" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Date">Date</label>
                        <input type="date" asp-for="Date" id="txtDate" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="TimeSlot">Time Slot</label>
                        <input type="time" asp-for="TimeSlot" id="txtTimeSlot" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Status">Status</label>
                        <input type="text" asp-for="Status" id="txtStatus" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Remark">Remark</label>
                        <textarea id="txtRemark" asp-for="Remark" rows="3" class="form-control"></textarea>
                    </div>
                    <button id="btnSave" type="button" class="btn btn-success">Save</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </form>
            </div>
        </div>
    </div>
</div>

<link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.css" rel="stylesheet" />
<link href="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.print.css" rel="stylesheet" media="print" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.4.0/fullcalendar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
    <script>
        $(document).ready(function () {
            // Initialize the fullCalendar
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultView: 'month',
                navLinks: true,
                editable: true,
                eventLimit: true,
                events: '/Home/GetEvents', // Replace with your server-side event fetching endpoint

                eventClick: function (calEvent, jsEvent, view) {
                    // Open the modal and display event details
                    $('#pDetails').text(calEvent.remark);
                    $('#btnEdit').attr('data-id', calEvent.Id);
                    $('#btnDelete').attr('data-id', calEvent.Id);
                    $('#myModal').modal();
                },

                select: function (start, end) {
                    // Open the modal for creating a new event
                    ClearFields();
                    $('#hdEventID').val(0);
                    $('#txtDate').val(moment(start).format('YYYY-MM-DD'));
                    $('#txtTimeSlot').val(moment(start).format('HH:mm'));
                    $('#myModalSave').modal('show'); // Open the modal form
                },

              dayClick: function (date, jsEvent, view) {
    // Open the modal for creating a new event on day click
    ClearFields();
    $('#hdEventID').val(0);
    $('#txtDate').val(date.format('YYYY-MM-DD'));
    $('#myModalSave').modal('show'); // Open the modal form
    $('#calendar').fullCalendar('unselect'); // Unselect the clicked date
}
            });

            // Save button click event
            $('#btnSave').click(function () {
                // Perform validation and save the event using AJAX
                var eventData = {
                    Id: $('#hdEventID').val(),
                    PId: $('#txtPId').val(),
                    DId: $('#txtDId').val(),
                    Date: $('#txtDate').val(),
                    TimeSlot: $('#txtTimeSlot').val(),
                    Status: $('#txtStatus').val(),
                    Remark: $('#txtRemark').val()
                };

                $.ajax({
                    url: '/Home/SaveEvent',
                    type: 'POST',
                    data: JSON.stringify(eventData),
                    contentType: 'application/json',
                    success: function (response) {
                        // Handle the success response
                        $('#myModalSave').modal('hide');
                        $('#calendar').fullCalendar('refetchEvents');
                    },
                    error: function (error) {
                        // Handle the error response
                    }
                });
            });

            function ClearFields() {
                // Clear the modal fields
                $('#hdEventID').val('');
                $('#txtPId').val('');
                $('#txtDId').val('');
                $('#txtDate').val('');
                $('#txtTimeSlot').val('');
                $('#txtStatus').val('');
                $('#txtRemark').val('');
            }
        });
    </script>
}
